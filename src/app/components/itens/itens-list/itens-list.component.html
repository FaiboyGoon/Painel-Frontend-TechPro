<br />
<div class="container">
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <h3 class="centre">Itens Disponíveis</h3>
          
          <!-- Filtros Avançados -->
          <div class="row mb-3">
            <div class="col-md-3">
              <input
                [(ngModel)]="filtros.pesquisa"
                type="text"
                class="form-control"
                placeholder="Pesquisar..."
              />
            </div>
            <div class="col-md-2">
              <select [(ngModel)]="filtros.tipoPesquisa" class="form-select">
                <option value="id">Por ID</option>
                <option value="descricao">Por Descrição</option>
              </select>
            </div>
            <div class="col-md-2">
              <input
                [(ngModel)]="filtros.valorMin"
                type="number"
                class="form-control"
                placeholder="Valor mín (R$)"
              />
            </div>
            <div class="col-md-2">
              <input
                [(ngModel)]="filtros.valorMax"
                type="number"
                class="form-control"
                placeholder="Valor máx (R$)"
              />
            </div>
            <div class="col-md-3">
              <button
                type="button"
                class="btn btn-primary me-2"
                mdbRipple
                (click)="aplicarFiltros()"
              >
                <i class="fas fa-search"></i> Filtrar
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                mdbRipple
                (click)="limparFiltros()"
              >
                <i class="fas fa-times"></i> Limpar
              </button>
            </div>
          </div>

          <!-- Totalizadores -->
          <div class="row mb-3" *ngIf="!modoModal && lista.length > 0">
            <div class="col-md-12">
              <div class="alert alert-info d-flex justify-content-between align-items-center">
                <div>
                  <strong>Total de Itens:</strong> {{ lista.length }}
                </div>
                <div>
                  <strong>Valor Total do Estoque:</strong>
                  <span class="ms-2">{{ calcularValorTotalEstoque() | currency : "BRL" }}</span>
                  <small class="text-muted ms-2">({{ (calcularValorTotalEstoque() / taxaCambioAtual) | currency : "USD" }})</small>
                </div>
              </div>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-12 text-end">
              <button
                (click)="new()"
                class="btn btn-success btn-rounded"
                mdbRippled
              >
                <i class="fas fa-plus fa-sm"></i> Add Item
              </button>
            </div>
          </div>

          <div class="table-responsive">
            <table border="1" class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">ID</th>
                  <th scope="col">Descrição</th>
                  @if (!modoModal) {
                  <th scope="col">Valor/Un</th>
                  <th scope="col">Quantidade</th>
                  <th scope="col">Valor Total</th>
                  <th scope="col">ID Transação</th>
                  <th scope="col">Ações</th>
                  } @else {
                  <th scope="col">Selecionar</th>
                  }
                </tr>
              </thead>
              <tbody>
                @for (item of listaFiltrada; track $index) {
                <tr>
                  <td>{{ item.id }}</td>
                  <td>{{ item.descricao }}</td>
                  @if (!modoModal){
                  <td>
                    <div>{{ item.valorUnitario | currency : "BRL" }}</div>
                    <small class="text-muted">{{ (item.valorUnitario / taxaCambioAtual) | currency : "USD" }}</small>
                  </td>
                  <td>{{ item.quantidade }}</td>
                  <td>
                    <div>
                      <strong>{{ (item.quantidade * item.valorUnitario) | currency : "BRL" }}</strong>
                    </div>
                    <small class="text-muted">{{ ((item.quantidade * item.valorUnitario) / taxaCambioAtual) | currency : "USD" }}</small>
                  </td>
                  <td>{{ item.transacaoId || '---' }}</td>
                  <td class="direita">
                    <button
                      type="button"
                      class="btn btn-primary btn-rounded m-1"
                      mdbRipple
                      (click)="edit(item)"
                    >
                      <i class="fas fa-pencil fa-sm"></i>
                    </button>
                    <button
                      type="button"
                      class="btn btn-danger btn-rounded"
                      mdbRipple
                      (click)="excluirItem(item)"
                    >
                      <i class="fas fa-trash fa-sm"></i>
                    </button>
                  </td>
                  }@else {
                  <td class="direita">
                    <button
                      (click)="selecionar(item)"
                      class="btn btn-success btn-rounded"
                      mdbRippled
                    >
                      Selecionar
                    </button>
                  </td>
                  }
                </tr>
                }
                @if (listaFiltrada.length === 0) {
                <tr>
                  <td colspan="7" class="text-center">
                    Nenhum item encontrado.
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>